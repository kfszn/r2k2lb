<!DOCTYPE html>
<html lang="en">
<head>
  <title>R2K2 | Active Raffles</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Active raffles for the R2K2 community. Wager to enter and win!" />
  <meta property="og:image" content="/assets/logo.png" />
  <link rel="icon" type="image/png" href="/assets/logo.png" />

  <!-- Site CSS (kept) -->
  <link rel="stylesheet" href="/css/app.css" />
  <link rel="stylesheet" href="/css/vendor.css" />
  <link rel="stylesheet" href="/css/toast.css" />

  <style>
    :root{
      --bg-deep:#070b12;         /* page bg */
      --card:#0b0f17;            /* card bg */
      --border:#1b2a40;          /* subtle border */
      --ink:#e9f5ff;             /* text on dark */
      --muted:#a6c9ef;           /* muted text */
      --accent:#6b5cff;          /* purple accent */
      --blue:#1398ff;            /* rainbet blue */
    }

    html,body{background:var(--bg-deep);color:var(--ink);margin:0}

    /* ===== Header (simplified) ===== */
    #r2kHeader{
      position:sticky; top:0; z-index:2000;
      background:linear-gradient(180deg, rgba(7,10,16,0.98) 0%, rgba(5,8,13,0.98) 85%, rgba(3,5,9,1) 100%);
      backdrop-filter:blur(6px);
      border:none !important;
      box-shadow:0 4px 12px rgba(0,0,0,.4);
    }
    #r2kHeader .h-inner{max-width:1200px;margin:0 auto;padding:14px 20px;display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:16px;position:relative}
    #r2kHeader .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
    #r2kHeader .brand .logo{width:40px;height:40px;border-radius:50%;object-fit:cover;box-shadow:0 0 12px rgba(19,152,255,.35)}
    #r2kHeader .brand .name{font-size:22px;font-weight:800;color:#fff}
    #r2kHeader .brand .name .accent{color:var(--blue);text-shadow:0 0 10px rgba(19,152,255,.5)}
    #r2kHeader .nav{display:flex;justify-content:center;gap:26px}
    #r2kHeader .nav a{color:#e8f4ff;background:none;border:0;cursor:pointer;text-decoration:none;font-weight:700;font-size:14px;opacity:.92;padding:8px 6px;border-radius:8px;transition:.18s}
    #r2kHeader .nav a:hover{color:#fff;text-shadow:0 0 10px rgba(19,152,255,.45)}
    #r2kHeader .nav a[aria-current="page"]{color:#fff;text-shadow:0 0 10px rgba(19,152,255,.6)}
    #r2kHeader .actions{display:flex;justify-content:flex-end;gap:12px}
    #r2kHeader .btn{display:inline-flex;align-items:center;gap:8px;font-weight:800;font-size:14px;padding:10px 16px;border-radius:999px;text-decoration:none;border:1px solid rgba(19,152,255,.25);color:#0a1626;background:linear-gradient(90deg,#22b1ff,#1398ff);box-shadow:0 6px 20px rgba(19,152,255,.35),inset 0 0 10px rgba(255,255,255,.08);transition:transform .15s,box-shadow .15s,filter .15s}
    #r2kHeader .btn:hover{transform:translateY(-1px);filter:brightness(1.08);box-shadow:0 8px 26px rgba(19,152,255,.5)}
    #r2kHeader .hamburger{display:none;justify-self:end;cursor:pointer}
    #r2kHeader .hamburger span{display:block;width:24px;height:3px;margin:4px 0;background:#e8f4ff;border-radius:2px}
    #r2kHeader::after{content:"";position:absolute;left:0;right:0;bottom:-4px;height:2px;background:linear-gradient(90deg,rgba(0,0,0,0) 0%,rgba(19,152,255,.45) 20%,rgba(19,152,255,.9) 50%,rgba(19,152,255,.45) 80%,rgba(0,0,0,0) 100%);box-shadow:0 0 18px rgba(19,152,255,.4);pointer-events:none;z-index:100}
    @media (max-width:900px){
      #r2kHeader .h-inner{grid-template-columns:1fr auto auto}
      #r2kHeader .nav{display:none;position:absolute;top:60px;left:0;right:0;background:#080f19;border-top:1px solid rgba(19,152,255,.15);padding:12px 20px;gap:16px;flex-direction:column}
      #r2kHeader .nav.show{display:flex}
      #r2kHeader .hamburger{display:flex}
      #r2kHeader .actions{display:none}
    }

    /* ===== Page layout ===== */
    .wrap{max-width:1200px;margin:0 auto;padding:24px 20px}
    .hero-title{font-weight:900;font-size:42px;text-align:center;margin-top:18px}
    .hero-sub{font-size:14px;color:var(--muted);text-align:center;margin-top:6px}
    .accent{color:#a99dff}

    /* Tabs */
    .tabs{display:flex;gap:10px;justify-content:center;margin-top:18px}
    .tab-btn{border:1px solid var(--border);background:#0c1320;color:#e9f5ff;padding:10px 16px;border-radius:999px;font-weight:800;cursor:pointer;opacity:.9}
    .tab-btn.active{background:linear-gradient(90deg,#22b1ff,#1398ff);color:#08111a;border-color:#0f5da1;opacity:1}
    .tab-panel{display:none;margin-top:22px}
    .tab-panel.active{display:block}

    /* Cards */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:10px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:20px;
      box-shadow:0 0 24px rgba(107,92,255,.07);
    }
    .card-glow{position:relative;overflow:hidden}
    .card-glow::before{
      content:"";
      position:absolute;inset:-2px;
      background:radial-gradient(120px 120px at 70px 70px, rgba(125,107,255,.15), transparent 60%),
                 radial-gradient(140px 140px at 85% 20%, rgba(19,152,255,.10), transparent 60%);
      pointer-events:none;
    }

    .prize{font-size:46px;font-weight:900;text-shadow:0 0 14px rgba(255,255,255,.25);text-align:center;margin-top:6px}
    .prize-label{text-align:center;color:var(--muted);font-weight:800;letter-spacing:.08em;margin-top:6px}

    .pill-row{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    .pill{background:#0c1320;border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
    .pill .big{font-weight:900}
    .pill .cap{font-size:12px;color:var(--muted);margin-top:4px}

    .stat{background:#0c1320;border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;margin-top:18px}
    .stat .count{font-weight:900}

    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      width:100%; padding:14px 16px; border-radius:12px; margin-top:18px;
      border:1px solid #2b2466; background:rgba(107,92,255,.1); color:#f0eaff; font-weight:800; cursor:pointer;
      transition:.18s;
      text-decoration:none;
    }
    .btn:hover{filter:brightness(1.07);box-shadow:0 0 18px rgba(107,92,255,.25) inset}
    .btn.alt{border-color:#0f5da1;background:linear-gradient(90deg,#22b1ff,#1398ff);color:#08111a;box-shadow:0 6px 20px rgba(19,152,255,.35)}

    .progress{margin-top:14px}
    .bar{height:12px;background:#081321;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .fill{height:100%;width:0;background:linear-gradient(90deg,#1398ff,#48c7ff);box-shadow:0 0 12px rgba(0,153,255,.55);transition:width .8s ease}
    .meta{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px}
    .meta .strong{color:#fff;font-weight:800}

    .tick-icon{
      display:inline-flex;align-items:center;justify-content:center;
      width:60px;height:60px;border-radius:16px;
      background:radial-gradient(60px 60px at 50% 50%, rgba(125,107,255,.22), rgba(125,107,255,.08));
      box-shadow:0 4px 30px rgba(125,107,255,.3) inset, 0 0 20px rgba(125,107,255,.15);
      margin:0 auto 6px;
    }
    .tick-icon svg{width:30px;height:30px;opacity:.95}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:3000}
    .modal .sheet{background:var(--card);border:1px solid var(--border);border-radius:14px;max-width:600px;width:92%;padding:18px}
    .list{max-height:340px;overflow:auto;border:1px dashed var(--border);border-radius:10px;margin-top:10px}
    .list-item{display:flex;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #0f1c2c}
    .list-item:nth-child(odd){background:#0a131f}
    .close-x{background:transparent;border:1px solid var(--border);padding:8px 12px;border-radius:10px;color:#cfe9ff;cursor:pointer}

    /* Winners table */
    .winners{width:100%;border-collapse:collapse;margin-top:10px}
    .winners th,.winners td{border:1px solid var(--border);padding:10px 12px;text-align:left}
    .winners th{background:#0c1320;color:#e9f5ff}
    .winners tr:nth-child(odd){background:#0a131f}

    @media (max-width:520px){ .pill-row{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- Header -->
  <header id="r2kHeader">
    <div class="h-inner">
      <a href="/" class="brand" aria-label="R2K2 Home">
        <img src="/assets/logo.png" class="logo" alt="R2K2">
        <div class="name">R2K<span class="accent">2</span></div>
      </a>

      <nav class="nav" id="r2kNav">
        <a href="/">Home</a>
        <a href="/leaderboard/rainbet">Leaderboard</a>
        <a href="/raffle" aria-current="page">Raffle</a>
        <a href="/challenges">Challenges</a>
      </nav>

      <div class="actions">
        <a class="btn" href="https://rainbet.com/?r=r2k2" target="_blank" rel="noopener">Join Rainbet</a>
      </div>

      <div class="hamburger" id="hamburger" aria-label="Menu" aria-controls="r2kNav" aria-expanded="false">
        <span></span><span></span><span></span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <h1 class="hero-title"><span class="accent">Active</span> Raffles</h1>
    <p class="hero-sub">Wager to automatically enter and win prizes. One ticket per eligible entrant ‚Äî fair and simple.</p>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="weekly">Weekly</button>
      <button class="tab-btn" data-tab="monthly">Monthly</button>
      <button class="tab-btn" data-tab="winners">Previous Winners</button>
    </div>

    <!-- WEEKLY -->
    <section class="tab-panel active" id="panel-weekly">
      <div class="grid">
        <article class="card card-glow">
          <div class="tick-icon">
            <svg viewBox="0 0 24 24" fill="#ffffff"><path d="M20 12v8a2 2 0 0 1-2 2h-5v-10h7zm-9 10H6a2 2 0 0 1-2-2v-8h7v10zM4 9h16v2H4V9zm4-7a3 3 0 0 1 3 3v1h-1a3 3 0 0 1-2-5zm8 0a3 3 0 0 1-2 5h-1V5a3 3 0 0 1 3-3z"/></svg>
          </div>
          <div class="prize" id="w-amount">$25.00</div>
          <div class="prize-label">WEEKLY CASH ‚Äî 1 winner</div>

          <div class="pill-row">
            <div class="pill">
              <div class="big" id="w-min">$250.00</div>
              <div class="cap">Min Wager (7-day window)</div>
            </div>
            <div class="pill">
              <div class="big" id="w-remaining">--</div>
              <div class="cap">Remaining (CST)</div>
            </div>
          </div>

          <div class="stat">
            <div class="count" id="w-participants">0</div>
            <div class="cap">Eligible Participants</div>
          </div>

          <div class="progress">
            <div class="bar"><div class="fill" id="w-fill" style="width:0%"></div></div>
            <div class="meta"><span id="w-pct">0%</span><span id="w-meta">0 / 0</span></div>
          </div>

          <button class="btn" id="w-view">üë• View Participants</button>
          <!-- Former Force Draw -> Join Rainbet -->
          <a class="btn alt" href="https://rainbet.com/?r=r2k2" target="_blank" rel="noopener">Join Rainbet</a>
        </article>
      </div>
      <p class="hero-sub">Eligibility resets every 7 days. Auto-draw runs at the end of the window.</p>
    </section>

    <!-- MONTHLY -->
    <section class="tab-panel" id="panel-monthly">
      <div class="grid">
        <article class="card card-glow">
          <div class="tick-icon">
            <svg viewBox="0 0 24 24" fill="#ffffff"><path d="M20 12v8a2 2 0 0 1-2 2h-5v-10h7zm-9 10H6a2 2 0 0 1-2-2v-8h7v10zM4 9h16v2H4V9zm4-7a3 3 0 0 1 3 3v1h-1a3 3 0 0 1-2-5zm8 0a3 3 0 0 1-2 5h-1V5a3 3 0 0 1 3-3z"/></svg>
          </div>
          <div class="prize" id="m-amount">$100.00</div>
          <div class="prize-label">MONTHLY CASH ‚Äî 1 winner</div>

          <div class="pill-row">
            <div class="pill">
              <div class="big" id="m-min">$5,000.00</div>
              <div class="cap">Min Wager (30-day window)</div>
            </div>
            <div class="pill">
              <div class="big" id="m-remaining">--</div>
              <div class="cap">Remaining (CST)</div>
            </div>
          </div>

          <div class="stat">
            <div class="count" id="m-participants">0</div>
            <div class="cap">Eligible Participants</div>
          </div>

          <div class="progress">
            <div class="bar"><div class="fill" id="m-fill" style="width:0%"></div></div>
            <div class="meta"><span id="m-pct">0%</span><span id="m-meta">0 / 0</span></div>
          </div>

          <button class="btn" id="m-view">üë• View Participants</button>
          <!-- Former Force Draw -> Join Rainbet -->
          <a class="btn alt" href="https://rainbet.com/?r=r2k2" target="_blank" rel="noopener">Join Rainbet</a>
        </article>
      </div>
      <p class="hero-sub">One entry per eligible user. Auto-draw runs when the 30-day window ends.</p>
    </section>

    <!-- PREVIOUS WINNERS -->
    <section class="tab-panel" id="panel-winners">
      <article class="card card-glow">
        <h3 style="margin:0 0 8px 0;">Previous Winners</h3>
        <p class="hero-sub" style="margin-top:0">Auto-logged on draw. (This demo persists in your browser‚Äôs localStorage.)</p>
        <table class="winners" id="winnersTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Raffle</th>
              <th>Winner</th>
              <th>Prize</th>
              <th>TX / Note</th>
            </tr>
          </thead>
          <tbody id="winnersBody">
            <!-- rows injected -->
          </tbody>
        </table>
      </article>
    </section>
  </main>

  <!-- Participants Modal -->
  <div class="modal" id="participantsModal" aria-hidden="true">
    <div class="sheet">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Participants</h3>
        <button class="close-x" id="closeModal">Close</button>
      </div>
      <div class="list" id="participantsList"></div>
    </div>
  </div>

  <script>
    /* Mobile menu */
    (function(){
      const burger=document.getElementById('hamburger');
      const nav=document.getElementById('r2kNav');
      if(burger&&nav){
        burger.addEventListener('click',()=>{
          const open = nav.classList.toggle('show');
          burger.setAttribute('aria-expanded', String(open));
        });
      }
    })();

    /* -------- Demo State (replace with API later) -------- */
    // Windows: weekly (7 days) and monthly (30 days).
    // One entry per eligible user (no ticket weighting).
    // Auto-draw triggers when window ends; winner is recorded to "previous winners".
    const STATE = {
      weekly: {
        prizeUSD: 25.00,
        minWager: 250,
        // roll every 7d ‚Äî anchor to "now" for demo
        startAt: Date.now(),
        durationMs: 7*24*3600*1000,
        participants: [], // {name}
      },
      monthly: {
        prizeUSD: 100.00,
        minWager: 5000,
        startAt: Date.now(),
        durationMs: 30*24*3600*1000,
        participants: [],
      },
      // In real impl, winners should be stored server-side.
      winners: JSON.parse(localStorage.getItem('r2k2_winners') || '[]')
    };

    /* Seed demo participants so UI isn't empty */
    STATE.weekly.participants = Array.from({length:18},(_,i)=>({name:`WeeklyUser_${i+1}`}));
    STATE.monthly.participants = Array.from({length:9},(_,i)=>({name:`MonthlyUser_${i+1}`}));

    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    /* Tabs */
    $$('.tab-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        $$('.tab-btn').forEach(b=>b.classList.remove('active'));
        $$('.tab-panel').forEach(p=>p.classList.remove('active'));
        btn.classList.add('active');
        $('#panel-'+btn.dataset.tab).classList.add('active');
      });
    });

    /* Helpers */
    const money = n => n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2});
    function timeLeft(endMs){
      const s = Math.max(0, Math.floor((endMs - Date.now())/1000));
      const d = Math.floor(s/86400), h = Math.floor((s%86400)/3600), m = Math.floor((s%3600)/60);
      return d>0 ? `${d}d ${h}h` : `${h}h ${m}m`;
    }
    function windowEnd(startAt,durationMs){ return startAt + durationMs; }

    function setFill(prefix, current, goal){
      const pct = Math.max(0, Math.min(100, goal? (current/goal)*100 : 0));
      $('#'+prefix+'-fill').style.width = pct + '%';
      $('#'+prefix+'-pct').textContent = Math.round(pct) + '%';
      $('#'+prefix+'-meta').textContent = `${current} / ${goal}`;
    }

    /* UI refs */
    const UI = {
      weekly: {
        remaining: $('#w-remaining'),
        participants: $('#w-participants'),
        viewBtn: $('#w-view'),
        fill: $('#w-fill'),
        pct: $('#w-pct'),
        meta: $('#w-meta')
      },
      monthly: {
        remaining: $('#m-remaining'),
        participants: $('#m-participants'),
        viewBtn: $('#m-view'),
        fill: $('#m-fill'),
        pct: $('#m-pct'),
        meta: $('#m-meta')
      }
    };

    /* Participants Modal */
    const modal = $('#participantsModal');
    const list  = $('#participantsList');
    $('#closeModal').addEventListener('click', ()=> { modal.style.display='none'; modal.setAttribute('aria-hidden','true'); });

    function openParticipants(kind){
      const items = STATE[kind].participants;
      const rows = items.length ? items.map(p=>{
        const name = String(p.name).replace(/[<>]/g,'');
        return `<div class="list-item"><span>${name}</span><span>üéüÔ∏è 1</span></div>`;
      }).join('') : `<div class="list-item"><span>No entries yet.</span><span></span></div>`;
      list.innerHTML = rows;
      modal.style.display='flex';
      modal.setAttribute('aria-hidden','false');
    }
    UI.weekly.viewBtn.onclick = ()=>openParticipants('weekly');
    UI.monthly.viewBtn.onclick = ()=>openParticipants('monthly');

    /* Render + timers */
    function renderPanels(){
      const wEnd = windowEnd(STATE.weekly.startAt, STATE.weekly.durationMs);
      const mEnd = windowEnd(STATE.monthly.startAt, STATE.monthly.durationMs);

      UI.weekly.remaining.textContent = timeLeft(wEnd);
      UI.monthly.remaining.textContent = timeLeft(mEnd);

      UI.weekly.participants.textContent = STATE.weekly.participants.length;
      UI.monthly.participants.textContent = STATE.monthly.participants.length;

      // Progress bars show participant count vs. an arbitrary goal for visuals (edit as you like)
      setFill('w', STATE.weekly.participants.length, 50);
      setFill('m', STATE.monthly.participants.length, 100);
    }

    function saveWinners(){ localStorage.setItem('r2k2_winners', JSON.stringify(STATE.winners)); }

    function addWinner(kind, name, prize){
      const dt = new Date();
      const yyyy = dt.getFullYear();
      const mm = String(dt.getMonth()+1).padStart(2,'0');
      const dd = String(dt.getDate()).padStart(2,'0');
      const label = `${mm}-${dd}-${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`;
      STATE.winners.unshift({ date: label, kind, name, prize });
      STATE.winners = STATE.winners.slice(0, 200); // keep it tidy
      saveWinners();
      paintWinners();
    }

    function runDraw(kind){
      const pool = STATE[kind].participants;
      if(!pool.length){ 
        addWinner(kind, 'No eligible entries', money(STATE[kind].prizeUSD));
        return;
      }
      const idx = Math.floor(Math.random()*pool.length);
      const winner = pool[idx]?.name || 'Unknown';
      addWinner(kind, winner, money(STATE[kind].prizeUSD));

      // Reset window (anchor to now); clear participants (demo)
      STATE[kind].startAt = Date.now();
      STATE[kind].participants = [];
    }

    function checkAutoDraw(){
      const now = Date.now();
      if(now >= windowEnd(STATE.weekly.startAt, STATE.weekly.durationMs))  runDraw('weekly');
      if(now >= windowEnd(STATE.monthly.startAt, STATE.monthly.durationMs)) runDraw('monthly');
    }

    function paintWinners(){
      const tbody = $('#winnersBody');
      if(!STATE.winners.length){
        tbody.innerHTML = `<tr><td colspan="5" style="color:#a6c9ef">No winners recorded yet.</td></tr>`;
        return;
      }
      tbody.innerHTML = STATE.winners.map(w=>{
        const raffle = w.kind === 'weekly' ? 'Weekly' : 'Monthly';
        return `<tr>
          <td>${w.date}</td>
          <td>${raffle}</td>
          <td>${(w.name||'').replace(/[<>]/g,'')}</td>
          <td>${w.prize}</td>
          <td>-</td>
        </tr>`;
      }).join('');
    }

    // Initial paint + intervals
    renderPanels();
    paintWinners();
    setInterval(()=>{ renderPanels(); checkAutoDraw(); }, 1000 * 30); // every 30s update timers/draws
  </script>
</body>
</html>