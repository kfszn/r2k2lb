<!DOCTYPE html>
<html lang="en">
<head>
  <title>R2K2 | Rainbet Leaderboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Exclusive wager races on Rainbet for code R2K2!">
  <meta property="og:image" content="/assets/logo.png">
  <link rel="icon" type="image/png" href="/assets/logo.png">

  <!-- Global CSS -->
  <link rel="stylesheet" href="/css/app.css">
  <link rel="stylesheet" href="/css/lb.css">
  <link rel="stylesheet" href="/css/vendor.css">
  <link rel="stylesheet" href="/css/toast.css">

  <script src="/js/countdown-roobet.js"></script>

  <style>
    .warning-message{
      width:90%;max-width:500px;margin:10px auto;background:rgba(255,0,0,.1);
      border:2px solid #ff4444;border-radius:4px;padding:15px;color:#ff4444;font-weight:700;
      text-align:center;box-sizing:border-box;
    }
    @media (max-width:768px){
      .warning-message{width:95%;padding:12px;font-size:14px;margin:10px auto}
    }

    /* ===== Modal ===== */
    .modal{display:none;position:fixed;z-index:1000;inset:0;overflow:auto;background:rgba(0,0,0,.7);opacity:0;transition:opacity .5s}
    .modal.show{opacity:1}
    .modal-content{
      background:linear-gradient(135deg,#1f2937,#111827);margin:10% auto;padding:25px;border:1px solid rgba(255,255,255,.1);
      border-radius:12px;width:80%;max-width:600px;box-shadow:0 10px 25px rgba(0,0,0,.5);
      transform:translateY(-20px);transition:.5s;position:relative;
    }
    .modal.show .modal-content{transform:translateY(0)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;
      border-bottom:1px solid rgba(255,255,255,.1);padding-bottom:15px;margin-bottom:15px}
    .modal-title{font-size:24px;font-weight:700;color:#fff;margin:0}
    .close{color:#aaa;font-size:28px;font-weight:700;cursor:pointer;transition:color .2s}
    .close:hover{color:#fff}
    .modal-body{color:#d1d5db;font-size:16px;line-height:1.6}

    /* ===== Totals / Progress ===== */
    .r2k-totals{display:flex;justify-content:center;align-items:stretch;flex-wrap:wrap;gap:30px;margin:28px auto 10px;width:min(1080px,92%)}
    .r2k-total-card{flex:0 1 360px;background:#0b0f17;border:1px solid #0e2038;border-radius:14px;padding:18px 20px;
      box-shadow:0 0 18px rgba(0,153,255,.25)}
    .r2k-total-label{font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:#87c8ff;opacity:.9}
    .r2k-total-value{margin-top:6px;font-weight:700;font-size:22px;color:#e9f5ff;text-shadow:0 0 10px rgba(0,153,255,.35)}
    .r2k-progress{margin-top:10px}
    .r2k-progress-bar{height:10px;background:rgba(8,20,35,.9);border:1px solid #0e2038;border-radius:999px;overflow:hidden}
    .r2k-progress-fill{height:100%;width:0;transition:width 900ms ease-in-out;
      background:linear-gradient(90deg,#1398ff,#48c7ff)}
    .r2k-progress-fill.over{background:linear-gradient(90deg,#22c55e,#86efac)}
    .r2k-progress-meta{display:flex;justify-content:space-between;font-size:12px;color:#87c8ff;margin-top:6px}

    .tmr{display:flex;align-items:center;gap:10px;margin-top:12px}
    .tmr-label{color:#b6d9ff;font-weight:900;text-transform:uppercase}
    .tmr-value{color:#fff;font-weight:900;font-size:18px;text-shadow:0 0 16px rgba(19,152,255,.8)}

    /* ===== Rows 4â€“10 ===== */
    #leaderboard-rows{
      width:min(1120px,95%);margin:18px auto 40px;display:flex;flex-direction:column;gap:12px;
    }
    .lb-row{
      display:grid;grid-template-columns:54px 64px 1fr auto auto;align-items:center;
      gap:14px;padding:16px 18px;background:#0b0f17;border:1px solid #0e2038;border-radius:14px;
      box-shadow:0 0 18px rgba(0,153,255,.15);
    }
    .lb-money.wager{color:#fff!important;text-shadow:0 0 8px rgba(19,152,255,.25)}
    .lb-money.prize{color:#39ff93;text-shadow:0 0 14px rgba(57,255,147,.55)}
    .lb-name{color:#d6ecff;font-weight:800;overflow:hidden;text-overflow:ellipsis}

    /* ===== Top 3 ===== */
    #top3-cards{
      display:flex;gap:14px;justify-content:center;flex-wrap:wrap;width:min(1120px,95%);margin:10px auto 24px;
    }
    .top-card-shadow-1{box-shadow:0 0 40px #FFD700}
    .top-card-shadow-2{box-shadow:0 0 40px #C0C0C0}
    .top-card-shadow-3{box-shadow:0 0 40px #CD7F32}
  </style>
</head>
<body>

<div id="toast"><span id="message"></span></div>

<header id="r2kHeader">
  <div class="h-inner">
    <a href="/" class="brand">
      <img src="/assets/logo.png" class="logo"><div class="name">R2K<span class="accent">2</span></div>
    </a>
    <nav class="nav" id="r2kNav">
      <a href="/">Home</a>
      <a href="/leaderboard/rainbet">Leaderboard</a>
      <a href="/raffle">Raffle</a>
      <a href="/challenges">Challenges</a>
    </nav>
    <div class="actions">
      <a class="btn" href="https://rainbet.com/?r=r2k2" target="_blank">Join Rainbet</a>
    </div>
    <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
  </div>
</header>

<canvas id="particleCanvas"></canvas>
<div class="glow-container">
  <div class="left-glow"></div><div class="right-glow"></div>
</div>

<div class="toggle-images" style="margin-top:50px;">
  <img class="game-image roobet-image" src="/assets/rainbet.png" style="cursor:pointer;opacity:1;"
       onclick="location.href='/leaderboard/rainbet'">
</div>

<div id="appContent">
  <div class="row text">
    <span class="title">
      <div class="price-wrapper glow">$3,000</div>
      MONTHLY CODE <span class="glow">R2K2</span> Leaderboard!
    </span>

    <span class="subtitle" style="color:#FFF;">
      Every <b>BET</b> on Rainbet under Code <b>R2K2</b> counts towards your score. <br>
      <i>The leaderboard updates every 15 minutes.</i><br>
      <div class="warning-message">It Only Takes One!</div>

      <button id="prevLeaderboardBtn" class="prev-lb-btn">
        PREVIOUS LEADERBOARD
      </button>

      <button id="currentLeaderboardBtn" class="prev-lb-btn" style="display:none;background:#22c55e;color:#000;">
        CURRENT LEADERBOARD
      </button>
    </span>
  </div>

  <!-- Totals -->
  <div class="r2k-totals">

    <div class="r2k-total-card">
      <div class="r2k-total-label">Current Deal</div>
      <div class="r2k-total-value" id="r2kDealWager">$0</div>
      <div class="r2k-progress">
        <div class="r2k-progress-bar">
          <div class="r2k-progress-fill" id="r2kDealFill"></div>
        </div>
        <div class="r2k-progress-meta">
          <span id="r2kDealPct" class="strong">0%</span>
          <span id="r2kDealMeta">$0 / $1,200,000</span>
        </div>
      </div>
      <div class="tmr">
        <span class="tmr-label">ENDING IN</span>
        <span id="deal-remaining" class="tmr-value">--</span>
      </div>
    </div>

    <div class="r2k-total-card">
      <div class="r2k-total-label">Current Leaderboard</div>
      <div class="r2k-total-value" id="r2kLbWager">$0</div>
      <div class="r2k-progress">
        <div class="r2k-progress-bar">
          <div class="r2k-progress-fill" id="r2kLbFill"></div>
        </div>
        <div class="r2k-progress-meta">
          <span id="r2kLbPct" class="strong">0%</span>
          <span id="r2kLbMeta">$0 / $2,250,000</span>
        </div>
      </div>
      <div class="tmr">
        <span class="tmr-label">ENDING IN</span>
        <span id="lb-remaining" class="tmr-value">--</span>
      </div>
    </div>

  </div>

  <div id="top3-cards"></div>
  <div id="leaderboard-rows"></div>

</div>

<!-- FOOTER -->
<div class="row inner-footer">
  <div class="col-5">
    <span class="copyright">R2Ktwo<br>All Right Reserved 2025.</span>
  </div>
  <div class="col">
    <span class="title">Socials</span>
    <div class="footer-socials">
      <a href="https://kick.com/R2Ktwo" class="social"><img src="/assets/kick.png" class="social-img">Kick</a>
      <a href="https://discord.gg/DwpA8vaGPj" class="social"><img src="/assets/discord.png" class="social-img">Discord</a>
    </div>
  </div>
  <div class="col">
    <span class="title">ResponsibleGambling.org</span>
    <span class="subtitle" style="font-size:9px;">Remember: Gambling over a long period will always result in losses. Please gamble responsibly.</span>
  </div>
</div>

<script src="/js/app.js"></script>
<script src="/js/particles.js"></script>
<script src="/js/toast.js"></script>

<!-- ====================== LEADERBOARD LOGIC ====================== -->
<script>
(function(){
  const API = "/api/leaderboard";
  const DEAL_GOAL = 1200000;
  const LB_GOAL   = 2250000;

  const DEAL_START = "2025-11-02";
  const DEAL_END   = "2025-12-01";

  const CUR_LB_START = "2025-11-25";
  const CUR_LB_END   = "2025-12-31";
  const CUR_LB_END_INSTANT = new Date("2025-12-31T23:59:59-05:00");

  const LB_EXTRA_DAYS = 30;
  const MS_DAY = 86400000;

  function parseISO(iso){
    const [y,m,d] = iso.split("-").map(Number);
    return {y, m1:m, d};
  }

  function boundaryUTC(y,m1,d){
    return new Date(Date.UTC(y, m1-1, d, 20,0,0)); // 8PM ET approx
  }

  function rainbetDateFromBoundary(d){
    return d.toISOString().slice(0,10);
  }

  function previousLBWindow(){
    const ds = parseISO(DEAL_START);
    const de = parseISO(DEAL_END);

    const startUTC   = boundaryUTC(ds.y, ds.m1, ds.d);
    const dealEndUTC = boundaryUTC(de.y, de.m1, de.d);
    const endUTC     = new Date(dealEndUTC.getTime() + LB_EXTRA_DAYS * MS_DAY);

    const prevEndUTC   = startUTC;
    const prevStartUTC = new Date(prevEndUTC.getTime() - (endUTC - startUTC));

    return {
      startISO: rainbetDateFromBoundary(prevStartUTC),
      endISO: rainbetDateFromBoundary(prevEndUTC),
      endInstantUTC: prevEndUTC
    };
  }

  function currentLBWindow(){
    return {
      startISO: CUR_LB_START,
      endISO: CUR_LB_END,
      endInstantUTC: CUR_LB_END_INSTANT
    };
  }

  function fmt(n){
    return Number(n).toLocaleString("en-US",{style:"currency",currency:"USD"});
  }

  async function fetchRows(start,end){
    const url = `${API}?start_at=${start}&end_at=${end}`;
    const res = await fetch(url);
    const json = await res.json();
    const list = json.affiliates || [];
    return list
      .map(a => ({username:a.username, wagered:Number(a.wagered_amount)}))
      .filter(x => x.wagered>0)
      .sort((a,b)=>b.wagered-a.wagered)
      .slice(0,10);
  }

  async function fetchTotal(start,end){
    const url = `${API}?start_at=${start}&end_at=${end}`;
    const res = await fetch(url);
    const json = await res.json();
    const list = json.affiliates || [];
    return list.reduce((t,a)=>t+Number(a.wagered_amount),0);
  }

  const rewards=[900,575,400,350,250,200,150,100,50,25];

  function maskName(n){
    if(!n) return "Unknown";
    if(n.length<=3) return n;
    return n.slice(0,2)+"*".repeat(n.length-3)+n.slice(-1);
  }

  function renderTop3(rows){
    const box=document.getElementById("top3-cards");
    box.innerHTML="";
    const glows=["top-card-shadow-1","top-card-shadow-2","top-card-shadow-3"];

    rows.slice(0,3).forEach((r,i)=>{
      const div=document.createElement("div");
      div.className=`css-jehefp ${glows[i]}`;
      if(i===1) div.style.transform="translateY(25px) scale(1.2)";
      if(i===2) div.style.transform="translateY(25px)";
      div.innerHTML=`
        <div style="position:absolute;top:8px;left:8px;background:rgba(0,0,0,.45);
             padding:4px 8px;border-radius:8px;font-weight:700;">#${i+1}</div>
        <img src="/assets/rainbetlogo.png" style="width:96px;border-radius:12px;">
        <div><span style="font-weight:900">${maskName(r.username)}</span></div>
        <div style="color:#9ac9ff;font-weight:800;margin-top:8px">Wagered</div>
        <div style="padding:10px 18px;border:1px solid #1b3760;background:#0c1a2d;border-radius:12px">
          <span style="font-weight:900;color:#fff">${fmt(r.wagered)}</span>
        </div>
        <div style="margin-top:10px;font-weight:900;color:#39ff93">${fmt(rewards[i])}</div>
      `;
      box.appendChild(div);
    });
  }

  function renderRows(rows){
    const list=document.getElementById("leaderboard-rows");
    list.innerHTML="";
    rows.slice(3).forEach((r,i)=>{
      const rank=i+4;
      const row=document.createElement("div");
      row.className="lb-row";
      row.innerHTML=`
        <img src="/assets/rainbetlogo.png" style="width:44px;height:44px;border-radius:10px">
        <div class="lb-rank">#${rank}</div>
        <div class="lb-name">${maskName(r.username)}</div>
        <div><span class="lb-label">Wagered</span><span class="lb-money wager">${fmt(r.wagered)}</span></div>
        <div><span class="lb-label">Prize</span><span class="lb-money prize">${fmt(rewards[rank-1]||0)}</span></div>
      `;
      list.appendChild(row);
    });
  }

  async function paintCurrent(){
    const w=currentLBWindow();
    const rows=await fetchRows(w.startISO,w.endISO);
    renderTop3(rows);
    renderRows(rows);
  }

  async function paintPrevious(){
    const w=previousLBWindow();
    const rows=await fetchRows(w.startISO,w.endISO);
    renderTop3(rows);
    renderRows(rows);
  }

  async function paintTotals(){
    const dealTotal=await fetchTotal(DEAL_START,DEAL_END);
    document.getElementById("r2kDealWager").textContent=fmt(dealTotal);
    const pctDeal=Math.min((dealTotal/DEAL_GOAL)*100,100);
    document.getElementById("r2kDealFill").style.width=pctDeal+"%";
    document.getElementById("r2kDealPct").textContent=Math.round(pctDeal)+"%";

    const lbTotal=await fetchTotal(CUR_LB_START,CUR_LB_END);
    document.getElementById("r2kLbWager").textContent=fmt(lbTotal);
    const pctLb=Math.min((lbTotal/LB_GOAL)*100,100);
    document.getElementById("r2kLbFill").style.width=pctLb+"%";
    document.getElementById("r2kLbPct").textContent=Math.round(pctLb)+"%";
  }

  function tick(){
    const dealSpan=document.getElementById("deal-remaining");
    const msDeal=new Date(DEAL_END+"T23:59:59-05:00").getTime()-Date.now();
    dealSpan.textContent = formatRemaining(msDeal);

    const w=currentLBWindow();
    const msLb=w.endInstantUTC.getTime()-Date.now();
    document.getElementById("lb-remaining").textContent = formatRemaining(msLb);
  }

  function formatRemaining(ms){
    if(ms<0) return "0s";
    const s=Math.floor(ms/1000);
    const d=Math.floor(s/86400);
    const h=Math.floor((s%86400)/3600);
    const m=Math.floor((s%3600)/60);
    const ss=s%60;
    if(d>0) return `${d}d ${h}h ${m}m`;
    if(h>0) return `${h}h ${m}m ${ss}s`;
    if(m>0) return `${m}m ${ss}s`;
    return `${ss}s`;
  }

  document.getElementById("prevLeaderboardBtn").addEventListener("click",()=>{
    document.getElementById("prevLeaderboardBtn").style.display="none";
    document.getElementById("currentLeaderboardBtn").style.display="inline-flex";
    paintPrevious();
  });

  document.getElementById("currentLeaderboardBtn").addEventListener("click",()=>{
    document.getElementById("currentLeaderboardBtn").style.display="none";
    document.getElementById("prevLeaderboardBtn").style.display="inline-flex";
    paintCurrent();
  });

  document.addEventListener("DOMContentLoaded",async()=>{
    await paintTotals();
    await paintCurrent();
    tick();
    setInterval(tick,1000);
  });

})();
</script>

</body>
</html>
